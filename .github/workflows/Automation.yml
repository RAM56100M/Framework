name: Automation Test
on:
  push:
    branches: [main, master]
jobs:
  test:
    timeout-minutes: 60
    runs-on: ubuntu-latest
    steps: 
     - uses: actions/checkout@v4
     - uses: actions/setup-node@v4
       with:
         node-version: 18
     - name: Installing dependencies
       run: npm ci
     - name: Installing Playwright Browsers
       run: npx playwright install --with-deps
     - name: Running Playwright test
       run: npm run runChrome
     - name: Print artifact path
       run: echo ${{ github.workspace }}/.github/workflows/${{ github.run_id }}/artifacts/
         
     - name: Uploading production Artifact
       uses: actions/upload-artifact@v4
       if: ${{ !cancelled() }}
       with:
        name: report
        path: | 
            playwright-report/
            !playwright-report/**/*.md
            
 
     - name: Download artifact
       uses: actions/download-artifact@v4
       with:
         name: report
         run-id: ${{ github.run_id }}
         
     - name: Show Artifacts
       run:  ls -lR
 
     - name: Send email
       uses: dawidd6/action-send-mail@v3
       with:
          server_address: smtp.gmail.com
          server_port: 587
          username: ${{ secrets.EMAIL_USERNAME}}
          password: ${{ secrets.EMAIL_PASSWORD}}
          subject: 'Test automation report for test execution'
          to: rammarshivane@gmail.com
          from: 'ram.marshivane@exaqode.com'
          body: 'Hey this is a test please omit answer me, I am sendig the test automation report executed on CI and sendind this message using workflow action!!! '
          attachments: 'playwright-report/**.html'
 